#!/usr/bin/python
def swap(ar, i, j):
      #print("swap [l={}, r={}]".format(ar[i], ar[j]))
      temp = ar[i]
      ar[i] = ar[j]
      ar[j] = temp
   
def partition(ar, istart, iend):
  """Falls back to insertion sort for arrays of size <= 10
  """

  #print("partition [ar={}, istart={}, iend={}]".format(ar, istart, iend))
  if iend <= istart:
    return 

  if iend - istart <= 10:
    # do insertion sort
    print("falling back to insertion sort.")
    for i in range(istart + 1, iend + 1):
      v = ar[i]
      j = i
      while j > 0 and ar[j - 1] > v:
        ar[j] = ar[j - 1]
        j -= 1
      
      ar[j] = v 
      
    return -1
  
  else: 
    # get the pivot
    pivotIdx = iend
    pivot = ar[iend]

    # init left and right pointers used to determine eventual partition index
    il=istart
    ir=iend - 1

    while il <= ir:
      if ar[il] <= pivot:
	il += 1
      elif ar[ir] > pivot:
	ir -= 1
      else:
	swap(ar, il, ir)
    #  print(ar) 
    if ar[il] > ar[pivotIdx]:
      swap(ar, il, pivotIdx)
    #print(ar)
    return il
 
def quicksort(ar, istart, iend):
  """an in place quicksort implementation.

  istart - the start of the subarray
  iend - the end of the subarray
  """

  if istart >= iend:
    return ar

  i = partition(ar, istart, iend)

  if i == -1:
    return ar

  print("partition result={}".format(i))
  quicksort(ar, istart, i-1)
  quicksort(ar, i, iend)

if __name__ == "__main__":
  #a = [5,4,9,1]
  a = [75, 400, 710, 966, 357, 775, 97, 990, 481, 285, 719, 293, 660, 748, 64, 1000, 713, 743, 365, 219, 952, 522, 601, 636, 40, 574, 752, 641, 65, 960, 609, 718, 209, 704, 609, 63, 529, 662, 976, 79, 560, 525, 814, 602, 88, 292, 286, 964, 883, 564, 710, 813, 474, 437, 789, 599, 122, 22, 859, 127, 680, 634, 754, 469, 188, 999, 522, 556, 161, 791, 993, 948, 465, 542, 909, 402, 388, 629, 148, 117, 518, 256, 421, 679, 731, 761, 144, 90, 338, 650, 732, 911, 527, 726, 859, 283, 411, 801, 773, 527, 109, 192, 964, 121, 534, 831, 823, 146, 192, 221, 881, 848, 421, 512, 185, 333, 917, 741, 284, 353, 440, 111, 482, 753, 698, 957, 527, 817, 34, 846, 60, 113, 687, 874, 416, 170, 504, 188, 529, 498, 746, 746, 281, 198, 924, 531, 275, 281, 4, 875, 58, 902, 241, 256, 305, 525, 867, 491, 709, 333, 865, 634, 125, 589, 668, 838, 824, 460, 499, 382, 183, 823, 779, 427, 741, 28, 19, 698, 801, 605, 123, 606, 412, 490, 690, 449, 889, 761, 515, 779, 71, 580, 126, 367, 35, 784, 27, 959, 998, 692, 161, 350, 959, 862, 425, 436, 224, 204, 666, 607, 212, 231, 872, 830, 486, 914, 865, 825, 456, 561, 330, 367, 313, 378, 157, 231, 365, 412, 948, 76, 836, 79, 429, 270, 456, 543, 548, 451, 706, 61, 94, 466, 270, 901, 548, 428, 19, 53, 765, 30, 898, 972, 466, 891, 737, 623, 220, 769, 580, 372, 322, 845, 462, 936, 402, 476, 641, 80, 90, 948, 826, 309, 192, 601, 924, 27, 712, 375, 643, 638, 78, 691, 264, 791, 450, 10, 747, 82, 138, 823, 785, 219, 196, 701, 722, 361, 130, 936, 494, 718, 208, 673, 371, 758, 230, 391, 557, 270, 645, 649, 176, 348, 845, 599, 361, 898, 663, 92, 638, 413, 966, 28, 473, 718, 986, 444, 50, 626, 374, 438, 843, 778, 611, 27, 338, 652, 606, 556, 438, 968, 947, 689, 632, 368, 456, 681, 221, 758, 295, 824, 504, 876, 417, 561, 694, 714, 456, 623, 818, 132, 855, 484, 242, 201, 486, 6, 23, 86, 791, 125, 547, 478, 310, 363, 962, 507, 901, 203, 940, 45, 97, 471, 90, 334, 906, 605, 345, 557, 350, 42, 217, 634, 290, 848, 977, 233, 129, 548, 527, 523, 574, 33, 510, 584, 417, 419, 501, 367, 230, 449, 773, 82, 19, 100, 691, 172, 144, 548, 46, 299, 986, 350, 157, 272, 551, 922, 317, 352, 409, 594, 456, 771, 4, 150, 984, 567, 419, 216, 907, 375, 572, 140, 714, 417, 870, 816, 343, 739, 762, 169, 307, 707, 851, 606, 33, 442, 752, 877, 8, 762, 63, 287, 90, 688, 248, 848, 565, 935, 309, 180, 880, 132, 575, 784, 577, 720, 817, 991, 201, 364, 310, 763, 853, 202, 238, 903, 878, 576, 61, 41, 751, 909, 943, 561, 250, 31, 851, 857, 892, 580, 731, 928, 149, 931, 776, 640, 847, 163, 183, 532, 169, 664, 555, 44, 766, 804, 883, 492, 892, 271, 617, 186, 495, 901, 598, 100, 238, 659, 240, 844, 919, 194, 820, 414, 76, 918, 1000, 442, 455, 421, 229, 412, 67, 529, 385, 149, 706, 483, 336, 910, 783, 450, 911, 467, 733, 854, 591, 153, 895, 96, 518, 443, 608, 74, 53, 49, 644, 131, 16, 616, 681, 499, 665, 488, 460, 726, 292, 843, 863, 249, 17, 115, 854, 881, 577, 82, 126, 482, 548, 933, 352, 346, 720, 831, 943, 293, 760, 228, 724, 612, 448, 289, 259, 447, 956, 644, 982, 117, 713, 518, 193, 543, 313, 440, 650, 651, 879, 523, 558, 838, 518, 672, 116, 315, 54, 679, 648, 338, 102, 982, 344, 159, 607, 471, 865, 651, 501, 903, 210, 877, 986, 70, 632, 343, 420, 364, 208, 632, 545, 564, 350, 868, 617, 807, 917, 192, 714, 354, 58, 595, 495, 624, 778, 247, 543, 587, 140, 663, 666, 156, 342, 519, 980, 66, 208, 608, 341, 51, 368, 297, 472, 18, 262, 349, 449, 121, 258, 709, 350, 616, 352, 353, 584, 911, 234, 999, 59, 221, 493, 49, 397, 945, 747, 623, 211, 533, 742, 726, 270, 845, 348, 859, 48, 438, 905, 601, 159, 599, 770, 900, 53, 213, 4, 206, 985, 831, 891, 891, 237, 629, 635, 444, 230, 679, 210, 459, 15, 311, 381, 92, 322, 625, 107, 16, 699, 455, 691, 357, 117, 390, 53, 418, 340, 543, 759, 913, 738, 694, 81, 999, 161, 539, 114, 691, 387, 943, 140, 947, 428, 272, 946, 507, 73, 953, 431, 644, 922, 425, 664, 651, 818, 90, 609, 264, 33, 697, 902, 470, 601, 903, 194, 524, 916, 243, 217, 190, 939, 934, 638, 709, 201, 383, 630, 627, 672, 794, 954, 954, 651, 45, 959, 158, 410, 127, 483, 325, 84, 546, 889, 735, 491, 73, 247, 565, 722, 507, 773, 814, 296, 944, 771, 700, 461, 61, 98, 946, 841, 205, 484, 545, 262, 211, 623, 758, 22, 43, 497, 926, 639, 192, 301, 350, 398, 891, 181, 604, 956, 852, 341, 732, 737, 738, 835, 840, 65, 192, 303, 685, 480, 921, 474, 13, 886, 567, 453, 568, 166, 654, 130, 268, 317, 568, 608, 888, 113, 300, 454, 148, 362, 492, 817, 544, 405, 589, 505, 420, 507, 274, 647, 212, 321, 611, 217, 53, 650, 731, 121, 659, 675, 330, 534, 480, 785, 742, 167, 647, 480, 78, 395, 486, 329, 240, 658, 211, 58, 76, 844, 787, 663, 397, 450, 400, 350, 518, 110, 801, 497, 297, 83, 176, 869, 481, 91, 866, 23, 806, 914, 113, 698, 149, 86, 208, 96, 510, 394, 900, 562, 186, 711, 520, 175, 106, 676, 543, 867, 404, 252, 884, 836, 55, 717, 441, 611, 64, 788, 221, 225, 710, 498, 190, 453, 38, 162, 706, 236, 293, 863, 659, 463, 28, 532, 416, 186, 507, 931, 638, 208, 299, 887, 175]
  print(a)
  quicksort(a, 0, len(a) - 1)
  print(a)
